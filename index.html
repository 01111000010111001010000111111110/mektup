<!doctype html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bir Mektup</title>
  <meta name="description" content="Benden Bana Ã§alarken okunan bir mektup." />
  <meta name="theme-color" content="#f3e9df" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="grain" aria-hidden="true"></div>
  <canvas id="sparkles" aria-hidden="true"></canvas>

  <!-- Autoplay gate: sadece mÃ¼zik iÃ§in. BasÄ±nca mektuba da gÃ¶tÃ¼rÃ¼r -->
  <div id="gate" class="gate" hidden>
    <div class="gate__card">
      <div class="gate__icon" aria-hidden="true">ğŸ§</div>
      <h2>Bir dokunuÅŸâ€¦</h2>
      <p>MÃ¼zik ve mektup aynÄ± anda baÅŸlasÄ±n ğŸ™‚</p>
      <button id="gateBtn" class="gate__btn" type="button">BaÅŸlat</button>
      <small>(TarayÄ±cÄ± bazen otomatik sesi engelliyor.)</small>
    </div>
  </div>

  <header class="site-top" role="banner">
    <div class="top-left">
      <span class="pill">ğŸ’Œ Bir Mektup</span>
      <span class="dot" aria-hidden="true">â€¢</span>
      <span class="muted">Benden Bana</span>
    </div>

    <div class="top-right">
      <span class="muted">Tarih</span>
      <span class="date" id="today">â€”</span>
      <button id="unmuteBtn" class="chip" type="button" aria-pressed="false" title="Sesi aÃ§/kapat">
        ğŸ”‡ Sessiz
      </button>
    </div>
  </header>

  <main class="wrap" role="main">
    <!-- Kapak (kÃ¼Ã§Ã¼k) -->
    <section class="cover" aria-label="Kapak">
      <div class="cover-card">
        <div class="seal" aria-hidden="true"><span class="seal__inner">ğŸ’</span></div>
        <h1>Bir Mektup</h1>
        <p class="subtitle">
          â€œDoÄŸru yerde miyim?â€ diye sorulan bir cÃ¼mleâ€¦ bazen gÃ¼nÃ¼ gÃ¼zelleÅŸtirmeye yetiyor.
        </p>

        <!-- SADECE "Mektubu AÃ§" var -->
        <div class="cover-actions">
          <a class="btn" href="#mektup">Mektubu AÃ§</a>
        </div>

        <p class="fineprint">
          MÃ¼zik otomatik baÅŸlar; tarayÄ±cÄ± izin vermezse tek dokunuÅŸ ister ğŸ™‚
        </p>
      </div>
    </section>

    <!-- Mektup: artÄ±k sayfada hemen gÃ¶rÃ¼nÃ¼r olacak (CSS ile) -->
    <article class="paper" id="mektup" aria-label="Mektup">
      <div class="paper__edge" aria-hidden="true"></div>

      <div class="paper-top">
        <div class="paper-title">
          <span class="label">Kime</span><span class="value">Zeynep</span>
        </div>
        <div class="paper-title">
          <span class="label">Kimden</span><span class="value">Levent</span>
        </div>
      </div>

      <div class="divider" aria-hidden="true"></div>
      <h2 class="salutation">Zeynep,</h2>

      <section class="letter">
        <p class="reveal">
          BugÃ¼n konuÅŸmalarÄ±mÄ±za bir daha dÃ¶ndÃ¼m. Bazen insan â€œne olmuÅŸ ki?â€ diye bakar ya,
          ben de Ã¶yle baÅŸladÄ±mâ€¦ ama en baÅŸa gelince durdum.
          <span class="quote">â€œDoÄŸru yerde miyim ki ğŸ§â€</span> dediÄŸin an,
          iÃ§imden direkt â€œevetâ€ deÄŸil de â€œiyi kiâ€ geÃ§ti.
        </p>

        <p class="reveal">
          Ä°lk dakikadan itibaren her ÅŸey doÄŸal aktÄ±. â€œAa sevindim ğŸ™‚â€, â€œNasÄ±lsÄ±nâ€â€¦
          KasÄ±lmadan, eÄŸip bÃ¼kmeden. Sonra seni ekleme muhabbetiâ€¦
          <span class="quote">â€œben pek bilmiyorumâ€</span> deyince anlatmaya baÅŸladÄ±m ya ğŸ˜„
          Benim hoÅŸuma giden ÅŸey, senin bÃ¶yle â€œtamam anladÄ±mâ€ deyiÅŸin.
        </p>

        <p class="reveal">
          Telefon ayarÄ± olayÄ± komikti. Ben â€œistersen kapatÄ±rsÄ±nâ€ dedim, sen â€œsorun deÄŸilâ€ dedin.
          Ben de â€œeÅŸit olalÄ±mâ€ diye saÃ§ma bir denge kurdum ğŸ˜‚
          Normalde bu kadar takÄ±lmam amaâ€¦ sende bÃ¶yle kÃ¼Ã§Ã¼k ÅŸeyler bile â€œanlamâ€ kazanÄ±yor.
        </p>

        <p class="reveal">
          Bir de ÅŸu <span class="quote">35 dakika bekleme</span> mevzusuâ€¦
          Sen <span class="quote">â€œEn azÄ±ndan 35 dakika beklemem ğŸ˜‹â€</span> deyince
          vallahi gÃ¼ldÃ¼m. Ben sabretmek iyidir diye kendimi motive ediyordum resmen.
          Åimdi iyi: bir mesaj uzaÄŸÄ±ndayÄ±z.
        </p>

        <p class="reveal">
          Senin ince tarafÄ±n var yaâ€¦ en Ã§ok orasÄ± hoÅŸuma gidiyor.
          <span class="quote">â€œKalp kÄ±rmaktan korkuyorumâ€</span> demen mesela.
          Bunu sÃ¶yleyen birinin kolay kolay kÄ±racaÄŸÄ±nÄ± sanmÄ±yorum.
          Ben de o yÃ¼zden baÅŸtan beri sÄ±nÄ±rlarÄ±nÄ± aÅŸmadan, ama samimiyeti de saklamadan ilerlemek istedim.
        </p>

        <p class="reveal">
          HemÅŸirelikâ€¦ 24 saat mesaiâ€¦ kolay deÄŸil.
          Ama sen â€œalÄ±ÅŸtÄ±mâ€ dedin ve â€œgÃ¼leryÃ¼zlÃ¼sÃ¼nâ€ diyorlar dedin.
          Ben buna hiÃ§ ÅŸaÅŸÄ±rmadÄ±m. Mesajdan bile belli oluyor o enerji ğŸ™‚
        </p>

        <p class="reveal">
          ÅarkÄ±lar kÄ±smÄ±â€¦ sen <span class="quote">â€œBenden Banaâ€</span> deyince kafama yazÄ±ldÄ±.
          Åu an o ÅŸarkÄ± Ã§alÄ±nca aklÄ±ma sen geliyorsa, sebebi â€œyapay romantiklikâ€ falan deÄŸil.
          BildiÄŸin alÄ±ÅŸkanlÄ±k gibiâ€¦ sessizce yerleÅŸti.
        </p>

        <p class="reveal">
          SatranÃ§: piko005 â€“ Chesscake ğŸ˜„
          Ä°lk oyunda â€œunutmuÅŸumâ€ dedin ama bence temelin var.
          Bir de <span class="quote">â€œHÄ±rslandÄ±m Levent ğŸ˜‚ğŸ˜‚â€</span>â€¦
          ben orada cidden gÃ¼ldÃ¼m. Bu, â€œben oyundan Ã§Ä±kmamâ€ demek. Karakter iÅŸi.
        </p>

        <p class="reveal">
          Ben uzun zamandÄ±r biriyle bÃ¶yle rahat konuÅŸmamÄ±ÅŸtÄ±m.
          Kuru gÃ¼rÃ¼ltÃ¼ deÄŸilâ€¦ gerÃ§ekten sohbet.
          Senin â€œkuru gÃ¼rÃ¼ltÃ¼yÃ¼ sevmemâ€ demen var yaâ€¦ aynÄ± yerden bakÄ±yoruz.
          O yÃ¼zden konuÅŸurken yorulmuyorum, tam tersine gÃ¼nÃ¼n iÃ§inde â€œiyi geldiâ€ oluyor.
        </p>

        <p class="closing reveal">
          Neyseâ€¦ uzatÄ±yorum ben ğŸ˜„
          Ama hani demiÅŸtim ya: â€œmektup gibi uzun uzun yazasÄ±m geliyorâ€.
          Ne zaman istersen yaz.
          Ben buradayÄ±m.
          Bir mesaj uzaÄŸÄ±ndayÄ±m.
        </p>

        <div class="signature reveal">
          <div class="sig-line" aria-hidden="true"></div>
          <p class="sig-name">Levent ğŸ™‚</p>
          <p class="sig-note">PS: Tabletâ€™e de kur. Bir el daha oynarÄ±z. â™Ÿï¸</p>
        </div>
      </section>

      <footer class="paper-footer" aria-label="Alt bilgi">
        <button class="chip" type="button" id="scrollTop">â†‘ YukarÄ±</button>
        <span class="muted">GitHub Pages</span>
      </footer>
    </article>
  </main>

  <audio id="bgm" loop preload="auto" autoplay playsinline></audio>

  <script>
    // Tarih
    const d = new Date();
    const fmt = new Intl.DateTimeFormat('tr-TR', { day: '2-digit', month: 'long', year: 'numeric' });
    document.getElementById('today').textContent = fmt.format(d);

    // ROOT mp3
    const audio = document.getElementById('bgm');
    audio.src = "loop.mp3";

    const gate = document.getElementById('gate');
    const gateBtn = document.getElementById('gateBtn');
    const unmuteBtn = document.getElementById('unmuteBtn');

    function setMuteUI(){
      const muted = audio.muted || audio.volume === 0;
      unmuteBtn.textContent = muted ? "ğŸ”‡ Sessiz" : "ğŸ”Š Ses AÃ§Ä±k";
      unmuteBtn.setAttribute("aria-pressed", String(!muted));
    }

    function goToLetter(){
      const target = document.getElementById('mektup');
      if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      location.hash = '#mektup';
    }

    async function tryAutoplayMuted(){
      audio.muted = true;
      audio.volume = 1.0;
      try {
        await audio.play();
        setMuteUI();
        return true;
      } catch {
        return false;
      }
    }

    async function unmuteAndPlay(){
      audio.muted = false;
      try { await audio.play(); } catch {}
      setMuteUI();
    }

    (async () => {
      const ok = await tryAutoplayMuted();
      if (!ok) gate.hidden = false;

      // Ä°lk kullanÄ±cÄ± hareketi: mektuba gÃ¶tÃ¼r + mÃ¼ziÄŸi aÃ§mayÄ± dene
      const unlock = async () => {
        if (!gate.hidden) gate.hidden = true;
        goToLetter();
        await unmuteAndPlay();
      };
      window.addEventListener('pointerdown', unlock, { once: true });
      window.addEventListener('keydown', unlock, { once: true });

      setMuteUI();
    })();

    // Gate button: kesin kapat + mektuba git + mÃ¼ziÄŸi aÃ§mayÄ± dene
    gateBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      gate.hidden = true;
      goToLetter();
      await unmuteAndPlay();
    });

    // Toggle
    unmuteBtn.addEventListener('click', async () => {
      if (audio.muted || audio.volume === 0) {
        await unmuteAndPlay();
      } else {
        audio.muted = true;
        setMuteUI();
      }
    });

    // YukarÄ±
    document.getElementById('scrollTop').addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Reveal
    const els = document.querySelectorAll('.reveal');
    const io = new IntersectionObserver((entries) => {
      for (const e of entries) if (e.isIntersecting) e.target.classList.add('in');
    }, { threshold: 0.14 });
    els.forEach(el => io.observe(el));

    // Sparkles
    const canvas = document.getElementById('sparkles');
    const ctx = canvas.getContext('2d');
    let W, H, t = 0;

    const sparks = Array.from({ length: 110 }, () => ({
      x: Math.random(),
      y: Math.random(),
      r: Math.random() * 2.0 + 0.4,
      s: Math.random() * 0.28 + 0.06,
      p: Math.random() * Math.PI * 2
    }));

    function resize(){
      W = canvas.width = window.innerWidth;
      H = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function draw(){
      t += 0.008;
      ctx.clearRect(0, 0, W, H);

      const glow = ctx.createRadialGradient(W*0.18, H*0.12, 0, W*0.18, H*0.12, Math.min(W,H)*0.85);
      glow.addColorStop(0, 'rgba(170,88,110,0.10)');
      glow.addColorStop(1, 'rgba(170,88,110,0)');
      ctx.fillStyle = glow;
      ctx.fillRect(0, 0, W, H);

      for (const s of sparks){
        const x = (s.x + Math.sin(t + s.p)*0.012) * W;
        const y = (s.y + Math.cos(t*0.85 + s.p)*0.012) * H;
        const a = 0.10 + 0.18*Math.sin(t*3.2 + s.p);

        ctx.beginPath();
        ctx.arc(x, y, s.r*(1+0.25*Math.sin(t*2+s.p)), 0, Math.PI*2);
        ctx.fillStyle = `rgba(255,255,255,${a})`;
        ctx.fill();

        s.y -= s.s/1000;
        if (s.y < -0.06) { s.y = 1.06; s.x = Math.random(); }
      }
      requestAnimationFrame(draw);
    }
    draw();
  </script>
</body>
</html>
